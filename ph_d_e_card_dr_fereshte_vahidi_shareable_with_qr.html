<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Congratulations, Dr. Fereshte Vahidi! üéì</title>
  <meta name="description" content="A shareable e‚Äëcard where friends can post messages and photos for Dr. Fereshte Vahidi. Includes a QR code to share the link."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020; --card:#111832; --ink:#eaeefb; --muted:#b8c0e0; --accent:#7c9cf6; --accent2:#7cf6cf; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:linear-gradient(180deg,#060a18,#111832);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:var(--accent)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{
      background:radial-gradient(1200px 400px at 10% -10%,rgba(124,156,246,.35),transparent),
                 radial-gradient(800px 300px at 90% 0,rgba(124,246,207,.25),transparent);
      border-radius:24px;padding:32px;position:relative;overflow:hidden
    }
    .title{font-size: clamp(28px, 4vw, 52px);font-weight:800;margin:0 0 8px}
    .subtitle{margin:0 0 20px;color:var(--muted);font-size:clamp(14px,2vw,18px)}
    .badge{display:inline-flex;gap:8px;align-items:center;background:rgba(255,255,255,.06);padding:8px 12px;border:1px solid rgba(255,255,255,.1);border-radius:999px;font-size:12px;color:var(--muted)}
    .row{display:flex;flex-wrap:wrap;gap:16px}
    .grow{flex:1 1 320px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:18px}
    form .field{display:flex;flex-direction:column;margin:10px 0}
    label{font-weight:600;margin-bottom:6px}
    input[type="text"], textarea{
      background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);color:var(--ink);
      border-radius:12px;padding:10px 12px;font-size:14px;outline:none
    }
    textarea{min-height:96px;resize:vertical}
    input[type="file"]{border:1px dashed rgba(255,255,255,.2);padding:14px;border-radius:12px}
    .hint{color:var(--muted);font-size:12px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{
      appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer
    }
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#0b1020}
    .btn-secondary{background:rgba(255,255,255,.06);color:var(--ink);border:1px solid rgba(255,255,255,.1)}
    .btn-danger{background:var(--danger);color:#fff}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;margin-top:16px}
    .msg{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
    .msg .media{width:100%;aspect-ratio:4/3;object-fit:cover;background:#000}
    .msg .body{padding:12px}
    .msg .name{font-weight:700}
    .msg .time{color:var(--muted);font-size:12px}
    .empty{color:var(--muted);text-align:center;padding:28px;border:1px dashed rgba(255,255,255,.15);border-radius:16px}
    .footer{margin:32px 0;color:var(--muted);font-size:12px;text-align:center}
    dialog{background:var(--card);color:var(--ink);border:1px solid rgba(255,255,255,.15);border-radius:16px;padding:20px}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .qr{display:flex;align-items:center;justify-content:center;}
    .pill{display:inline-block;padding:2px 8px;border:1px solid rgba(255,255,255,.15);border-radius:999px;font-size:11px;color:var(--muted)}
    .notice{font-size:12px;color:var(--muted)}
    .tag{display:inline-flex;gap:6px;align-items:center}
    .hide{display:none}
      @media print{
      header .actions, #postForm, details, #shareBtn, #qrBtn, #clearLocal, #saveCfg, #resetCfg, .footer { display:none !important; }
      body{ background:#fff; color:#000; }
      .card{ border-color:#ddd; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge">üéì PhD Defense ‚Ä¢ Guestbook</div>
      <h1 class="title">Congratulations, Dr. Fereshte Vahidi! ü•≥</h1>
      <p class="subtitle">Leave a message, drop a photo, and help us celebrate this huge milestone.</p>
      <div class="actions">
        <button id="shareBtn" class="btn-secondary">üîó Share Link</button>
        <button id="qrBtn" class="btn-secondary">üì± Show QR</button>
        <button id="printBtn" class="btn-secondary">üñ®Ô∏è Print / Save PDF</button>
        <button id="viewOnlyBtn" class="btn-secondary" title="Copy a read-only link">üëÄ Copy View‚ÄëOnly Link</button>
        <button id="slideBtn" class="btn-secondary" title="Full-screen gallery mode">üéûÔ∏è Start Slideshow</button>
        <button id="exportBtn" class="btn-secondary" title="Download messages as files">‚¨áÔ∏è Export</button>
        <span class="pill" id="modePill">Mode: <strong style="margin-left:6px" id="modeLabel">Local demo</strong></span>
      </div>
    </header>

    <section class="row" style="margin-top:18px" id="inputSection">
      <div class="grow card">
        <form id="postForm">
          <div class="field">
            <label for="name">Your name (optional)</label>
            <input type="text" id="name" placeholder="e.g., Ali, Sara, The Lab Squad"/>
          </div>
          <div class="field">
            <label for="message">Message to Dr. Vahidi</label>
            <textarea id="message" required maxlength="800" placeholder="Write something sweet, funny or proud!"></textarea>
            <div class="hint"><span id="charLeft">800</span> characters left</div>
          </div>
          <div class="field">
            <label for="photos">Photo(s) (optional)</label>
            <input id="photos" type="file" accept="image/*" multiple />
            <div class="hint">Up to 3 images ‚Ä¢ Max 4 MB each</div>
          </div>
          <div class="actions">
            <button class="btn-primary" type="submit">‚ûï Add to Card</button>
            <button class="btn-secondary" type="button" id="clearLocal" title="Local mode only">üßπ Clear local data</button>
          </div>
          <p class="notice" id="storageNotice">This page works without setup (local demo). To make it live so everyone sees the same wall, add your Firebase config below and re‚Äëload.</p>
        </form>
      </div>

      <div class="card" style="flex:1 1 260px" id="adminSection">
        <h3 style="margin:0 0 8px">Admin (optional)</h3>
        <p class="notice">Paste your Firebase config to enable real‚Äëtime shared mode.</p>
        <details>
          <summary class="tag">‚öôÔ∏è Firebase Settings</summary>
          <div class="field" style="margin-top:10px">
<textarea id="fbConfig" style="width:100%;height:140px;background:rgba(255,255,255,.04);color:var(--ink);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px" placeholder='{
  "apiKey": "PASTE_YOUR_FIREBASE_API_KEY_HERE",
  "authDomain": "your-app.firebaseapp.com",
  "projectId": "your-app",
  "storageBucket": "your-app.appspot.com",
  "messagingSenderId": "...",
  "appId": "..."
}'></textarea>
            <div class="actions">
              <button class="btn-secondary" id="saveCfg">üíæ Save & Reload</button>
              <button class="btn-danger" id="resetCfg">‚Ü©Ô∏é Reset</button>
            </div>
          </div>
        </details>
        <p class="notice">Tip: Create a free Firebase project ‚Üí Firestore (production) + Storage. Enable Anonymous Auth. Paste the config above.</p>
      </div>
    </section>

    <section style="margin-top:16px" class="card">
      <div class="row" style="align-items:center;justify-content:space-between">
        <h3 style="margin:0">üíå Messages & Photos</h3>
        <span class="pill" id="countPill">0 posts</span>
      </div>
      <div id="grid" class="grid" style="margin-top:10px"></div>
      <div id="emptyState" class="empty">No posts yet ‚Äî be the first! ‚ú®</div>
    </section>

    <p class="footer">Made with ‚ù§Ô∏è for Dr. Fereshte Vahidi‚Äôs PhD celebration. This page can show a QR that links directly here.
    <br><span class="notice">Note: Photos are resized client‚Äëside; for privacy, avoid uploading sensitive images.</span></p>
  </div>

  <!-- QR modal -->
  <dialog id="qrModal">
    <h3 style="margin-top:0">Scan to sign the card</h3>
    <div class="qr"><canvas id="qrCanvas" width="260" height="260" aria-label="QR code"></canvas></div>
    <div class="actions" style="margin-top:12px;justify-content:space-between">
      <button class="btn-secondary" id="dlQR">‚¨áÔ∏è Download PNG</button>
      <button class="btn-primary" id="closeQR">Close</button>
    </div>
  </dialog>

  <!-- Slideshow modal -->
  <dialog id="slideModal">
    <div style="display:flex;flex-direction:column;gap:10px;min-width:min(92vw,980px)">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Guestbook Slideshow</h3>
        <div class="actions">
          <button id="prevSlide" class="btn-secondary">‚óÄÔ∏é Prev</button>
          <button id="nextSlide" class="btn-secondary">Next ‚ñ∂Ô∏é</button>
          <button id="playPause" class="btn-secondary">‚ñ∂Ô∏é Auto</button>
          <button id="closeSlide" class="btn-primary">Close</button>
        </div>
      </div>
      <div id="slideStage" style="background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.12);border-radius:16px;min-height:360px;display:flex;align-items:center;justify-content:center;overflow:hidden"></div>
      <div id="slideCaption" class="notice"></div>
    </div>
  </dialog>

  <!-- Libraries (QR + Firebase compat builds for easy inline use) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js" integrity="sha384-y8C0YFfX3T9m9a8K7WQeLQ7p3KZ0G1M9hQ1aS7H7Uu3K1l3m4z9qv2r7y2Yf8XvO" crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <script>
  // ---------- Utility helpers ----------
  const $ = (sel) => document.querySelector(sel);
  const getParam = (k) => new URLSearchParams(location.search).get(k);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const fmtTime = (ts) => new Date(ts).toLocaleString();
  const uid = () => Math.random().toString(36).slice(2)+Date.now().toString(36);

  const CONFIG_KEY = 'ecard_fb_config_v1';
  const LOCAL_KEY = 'ecard_local_posts_v1';

  // Load stored Firebase config (if any)
  function loadConfig(){
    try{ return JSON.parse(localStorage.getItem(CONFIG_KEY)||'{}'); }catch(e){ return {}; }
  }
  function saveConfig(obj){ localStorage.setItem(CONFIG_KEY, JSON.stringify(obj||{})); }

  // Resize image to max width 1600px for lighter uploads
  function resizeImage(file, maxW=1600){
    return new Promise((resolve)=>{
      const img = new Image();
      const url = URL.createObjectURL(file);
      img.onload = ()=>{
        const scale = Math.min(1, maxW/img.width);
        const canvas = document.createElement('canvas');
        canvas.width = Math.round(img.width*scale);
        canvas.height = Math.round(img.height*scale);
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        canvas.toBlob(b=>{ URL.revokeObjectURL(url); resolve(b||file); }, 'image/jpeg', 0.88);
      };
      img.src = url;
    });
  }

  // ---------- Mode detection (Local vs Firebase) ----------
  let app=null, db=null, storage=null, auth=null, mode='local';
  const cfg = loadConfig();
  const looksConfigured = cfg && cfg.apiKey && !String(cfg.apiKey).includes('PASTE_YOUR_FIREBASE_API_KEY_HERE');

  if(looksConfigured){
    try{
      app = firebase.initializeApp(cfg);
      db = firebase.firestore();
      storage = firebase.storage();
      auth = firebase.auth();
      mode='cloud';
      $('#modeLabel').textContent='Shared (Firebase)';
      $('#storageNotice').classList.add('hide');
      $('#clearLocal').classList.add('hide');
    }catch(e){
      console.warn('Firebase init failed, falling back to local mode', e);
      mode='local';
    }
  } else {
    mode='local';
    $('#modeLabel').textContent='Local demo';
  }

  // ---------- Rendering ----------
  function render(posts){
    const grid = $('#grid');
    const empty = $('#emptyState');
    grid.innerHTML='';
    if(!posts || posts.length===0){
      empty.style.display='block';
      $('#countPill').textContent='0 posts';
      return;
    }
    empty.style.display='none';
    $('#countPill').textContent = posts.length + (posts.length===1?' post':' posts');
    posts.forEach(p=>{
      const card = document.createElement('article');
      card.className='msg';
      let mediaHTML='';
      (p.photos||[]).slice(0,1).forEach(url=>{ mediaHTML+=`<img class="media" alt="photo" loading="lazy" src="${url}"/>`; });
      card.innerHTML = `
        ${mediaHTML}
        <div class="body">
          <div class="name">${(p.name||'Anonymous')}</div>
          <div style="margin:6px 0 8px;white-space:pre-wrap">${escapeHtml(p.message||'')}</div>
          <div class="time">${fmtTime(p.createdAt||Date.now())}</div>
        </div>`;
      grid.appendChild(card);
    });
  }

  function escapeHtml(str){
    return String(str)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;')
      .replace(/\"/g,'&quot;')
      .replace(/'/g,'&#39;')
      .replace(/\//g,'&#47;');
  })[m]; });
  }

  // ---------- Data layer ----------
  let unsubscribe = null;
  async function listPosts(){
    if(mode==='cloud'){
      const snap = await db.collection('messages').orderBy('createdAt','desc').limit(200).get();
      return snap.docs.map(d=>({id:d.id, ...d.data()}));
    } else {
      try{ return JSON.parse(localStorage.getItem(LOCAL_KEY)||'[]'); } catch(e){ return []; }
    }
  }

  function subscribePosts(){
    if(mode!=='cloud') return;
    if(unsubscribe) unsubscribe();
    unsubscribe = db.collection('messages').orderBy('createdAt','desc').limit(200)
      .onSnapshot((snap)=>{
        const posts = snap.docs.map(d=>({id:d.id, ...d.data()}));
        render(posts);
      });
  }));
    } else {
      try{ return JSON.parse(localStorage.getItem(LOCAL_KEY)||'[]'); } catch(e){ return []; }
    }
  }

  async function addPost({name,message,files}){
    const createdAt = Date.now();
    let photos=[];

    // Pre-process files (max 3)
    const selected = Array.from(files||[]).slice(0,3);

    if(mode==='cloud'){
      await auth.signInAnonymously().catch(()=>{});
      for(const f of selected){
        const blob = await resizeImage(f);
        const ref = storage.ref().child(`uploads/${createdAt}_${uid()}.jpg`);
        await ref.put(blob);
        const url = await ref.getDownloadURL();
        photos.push(url);
      }
      const doc = {name:name||'Anonymous', message, photos, createdAt};
      const res = await db.collection('messages').add(doc);
      return {id:res.id, ...doc};
    } else {
      for(const f of selected){
        const blob = await resizeImage(f);
        const b64 = await blobToDataURL(blob);
        photos.push(b64);
      }
      const post = {id:uid(), name:name||'Anonymous', message, photos, createdAt};
      const arr = await listPosts();
      arr.unshift(post);
      localStorage.setItem(LOCAL_KEY, JSON.stringify(arr));
      return post;
    }
  }

  function blobToDataURL(blob){
    return new Promise((resolve)=>{
      const fr = new FileReader();
      fr.onload = ()=>resolve(fr.result);
      fr.readAsDataURL(blob);
    })
  }

  // ---------- QR tools ----------
  async function showQR(){
    const url = window.location.href;
    const canvas = $('#qrCanvas');
    await QRCode.toCanvas(canvas, url, {margin:1, width:256});
    $('#qrModal').showModal();
  }

  function downloadCanvasPNG(canvas, filename){
    const a = document.createElement('a');
    a.download = filename;
    a.href = canvas.toDataURL('image/png');
    a.click();
  }

  // ---------- Event wiring ----------
  document.addEventListener('DOMContentLoaded', async ()=>{
    // View-only mode via ?view=1
    const isViewOnly = getParam('view');
    if(isViewOnly){
      $('#inputSection').style.display='none';
      $('#adminSection') && ($('#adminSection').style.display='none');
    }

    // Initial load
    if(mode==='cloud'){ subscribePosts(); } else { render(await listPosts()); }

    // Character countdown
    const messageEl = $('#message');
    const charLeft = $('#charLeft');
    if(messageEl){
      messageEl.addEventListener('input', ()=>{ charLeft.textContent = 800 - messageEl.value.length; });
    }

    // Form submit
    const form = $('#postForm');
    if(form){
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const name = $('#name').value.trim();
        const message = $('#message').value.trim();
        const files = $('#photos').files;
        if(!message){ alert('Please write a message.'); return; }
        for (const f of files){ if(f.size > 4*1024*1024){ alert('Each image must be under 4 MB.'); return; } }
        const btn = e.submitter; const prev = btn.textContent; btn.disabled=true; btn.textContent='Uploading‚Ä¶';
        try{
          const post = await addPost({name,message,files});
          form.reset();
          charLeft.textContent = 800;
          const posts = await listPosts();
          render(posts);
          document.getElementById('grid').scrollIntoView({behavior:'smooth'});
        }catch(err){ console.error(err); alert('Sorry, something went wrong.'); }
        finally{ btn.disabled=false; btn.textContent=prev; }
      });
    }

    // Share link
    $('#shareBtn').addEventListener('click', async ()=>{
      const url = window.location.href;
      if(navigator.share){ try{ await navigator.share({title:document.title, url}); } catch(_){} }
      try{ await navigator.clipboard.writeText(url); $('#shareBtn').textContent='‚úÖ Link copied!'; setTimeout(()=> $('#shareBtn').textContent='üîó Share Link', 1500);}catch(_){ prompt('Copy this link:', url); }
    });

    // Print / Save PDF
    $('#printBtn').addEventListener('click', ()=> window.print());

    // View-only link
    $('#viewOnlyBtn').addEventListener('click', async ()=>{
      const url = new URL(location.href);
      url.searchParams.set('view','1');
      try{ await navigator.clipboard.writeText(url.toString());
        $('#viewOnlyBtn').textContent='‚úÖ View‚ÄëOnly Copied'; setTimeout(()=> $('#viewOnlyBtn').textContent='üëÄ Copy View‚ÄëOnly Link',1500);
      }catch(_){ prompt('Copy this link:', url.toString()); }
    });

    // QR modal
    $('#qrBtn').addEventListener('click', showQR);
    $('#closeQR').addEventListener('click', ()=> $('#qrModal').close());
    $('#dlQR').addEventListener('click', ()=> downloadCanvasPNG($('#qrCanvas'), 'ecard-qr.png'));

    // Slideshow
    let slideIndex = 0, slideTimer=null, slidePosts=[];
    function stage(post){
      const stage = $('#slideStage');
      stage.innerHTML='';
      const hasPhoto = (post.photos||[]).length>0;
      if(hasPhoto){
        const img = new Image(); img.alt='slide image'; img.loading='eager'; img.style.maxWidth='100%'; img.style.maxHeight='68vh'; img.style.objectFit='contain';
        img.src = post.photos[0]; stage.appendChild(img);
      } else {
        const div = document.createElement('div');
        div.style.padding='40px'; div.style.textAlign='center';
        div.innerHTML = `<div style="font-size:22px;font-weight:800;margin-bottom:6px">${post.name||'Anonymous'}</div>
                         <div style="white-space:pre-wrap;font-size:18px;opacity:.9">${escapeHtml(post.message||'')}</div>`;
        stage.appendChild(div);
      }
      $('#slideCaption').innerHTML = `<strong>${post.name||'Anonymous'}</strong> ‚Ä¢ ${fmtTime(post.createdAt)}`;
    }
    function show(i){ if(slidePosts.length===0) return; slideIndex = (i+slidePosts.length)%slidePosts.length; stage(slidePosts[slideIndex]); }
    function startAuto(){ if(slideTimer) return; slideTimer=setInterval(()=>show(slideIndex+1), 4000); $('#playPause').textContent='‚è∏ Stop'; }
    function stopAuto(){ clearInterval(slideTimer); slideTimer=null; $('#playPause').textContent='‚ñ∂Ô∏é Auto'; }

    async function openSlideshow(){
      slidePosts = await listPosts();
      if(slidePosts.length===0){ alert('No posts yet.'); return; }
      show(0);
      $('#slideModal').showModal();
      startAuto();
    }

    $('#slideBtn').addEventListener('click', openSlideshow);
    $('#closeSlide').addEventListener('click', ()=>{ stopAuto(); $('#slideModal').close(); });
    $('#nextSlide').addEventListener('click', ()=> show(slideIndex+1));
    $('#prevSlide').addEventListener('click', ()=> show(slideIndex-1));
    $('#playPause').addEventListener('click', ()=> slideTimer?stopAuto():startAuto());
    document.addEventListener('keydown', (e)=>{
      if(!$('#slideModal').open) return;
      if(e.key==='ArrowRight') show(slideIndex+1);
      if(e.key==='ArrowLeft') show(slideIndex-1);
      if(e.key===' ') { e.preventDefault(); slideTimer?stopAuto():startAuto(); }
      if(e.key==='Escape'){ stopAuto(); $('#slideModal').close(); }
    });

    // Auto start slideshow if ?slideshow=1
    if(getParam('slideshow')){ openSlideshow(); }

    // Export
    function toCSV(arr){
      const esc = (s)=> '"'+String(s||'').replace(/"/g,'""')+'"';
      const rows = [['name','message','photo1','photo2','photo3','createdAtISO']]
        .concat(arr.map(p=>[
          p.name||'Anonymous', p.message||'', (p.photos||[])[0]||'', (p.photos||[])[1]||'', (p.photos||[])[2]||'', new Date(p.createdAt||Date.now()).toISOString()
        ]));
      return rows.map(r=>r.map(esc).join(',')).join('
');
    }
    function download(name, mime, text){
      const blob = new Blob([text], {type:mime});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = name; a.click();
      setTimeout(()=> URL.revokeObjectURL(a.href), 1000);
    }
    $('#exportBtn').addEventListener('click', async ()=>{
      const posts = await listPosts();
      if(posts.length===0){ alert('No posts to export yet.'); return; }
      download('guestbook.json','application/json', JSON.stringify(posts, null, 2));
      download('guestbook.csv','text/csv', toCSV(posts));
    });

    // Config save/reset
    $('#saveCfg').addEventListener('click', ()=>{
      try{
        const val = JSON.parse($('#fbConfig').value||'{}');
        saveConfig(val); location.reload();
      }catch(_){ alert('Config must be valid JSON.'); }
    });
    $('#resetCfg').addEventListener('click', ()=>{ saveConfig({}); location.reload(); });

    // Clear local demo data
    $('#clearLocal').addEventListener('click', ()=>{
      if(confirm('Clear all locally stored posts on this device?')){
        localStorage.removeItem(LOCAL_KEY); render([]);
      }
    });
  });
  // Config save/reset
    $('#saveCfg').addEventListener('click', ()=>{
      try{
        const val = JSON.parse($('#fbConfig').value||'{}');
        saveConfig(val); location.reload();
      }catch(_){ alert('Config must be valid JSON.'); }
    });
    $('#resetCfg').addEventListener('click', ()=>{ saveConfig({}); location.reload(); });

    // Clear local demo data
    $('#clearLocal').addEventListener('click', ()=>{
      if(confirm('Clear all locally stored posts on this device?')){
        localStorage.removeItem(LOCAL_KEY); render([]);
      }
    });
  });
  </script>
</body>
</html>
